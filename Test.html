<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CORE STYLES */
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { width:100%; height:100%; overflow:hidden; background:black; font-family:'Segoe UI'; color:white; }
        
        /* VIDEO BACKGROUND */
        #video-container { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; }
        video { width:100%; height:100%; object-fit:cover; position:absolute; }
        #silent-video { display:block; }
        
        /* STATUS BARS */
        #rag-status { position:fixed; top:10px; left:10px; background:rgba(0,140,255,0.8); color:white; padding:5px 12px; border-radius:15px; font-size:12px; z-index:10; display:none; }
        #memory-status { position:fixed; top:10px; left:50%; transform:translateX(-50%); background:rgba(0,100,0,0.8); color:#0f0; padding:5px 15px; border-radius:15px; font-size:12px; z-index:10; display:none; }
        
        /* BUTTONS */
        .side-btn { position:fixed; top:20px; right:20px; z-index:20; background:rgba(0,0,0,0.5); color:white; border:1px solid rgba(255,255,255,0.3); width:50px; height:50px; border-radius:50%; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
        
        /* MODALS */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:100; flex-direction:column; padding:20px; }
        .modal-content { background:#222; border-radius:15px; padding:20px; width:90%; max-width:400px; border:2px solid #ff4500; margin:auto; max-height:85vh; overflow-y:auto; }
        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #444; }
        .modal-title { color:#ff4500; font-size:22px; font-weight:bold; }
        .close-btn { color:white; font-size:28px; cursor:pointer; }
        
        /* SETTINGS */
        .settings-section { margin:15px 0; padding-top:15px; border-top:1px solid #333; }
        .section-title { color:#aaa; font-size:12px; margin-bottom:10px; text-transform:uppercase; }
        .checkbox { display:flex; align-items:center; justify-content:space-between; margin:10px 0; padding:10px; background:#333; border-radius:8px; }
        .checkbox input { transform:scale(1.3); }
        
        /* MENU */
        .menu-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:20px 0; }
        .menu-btn { background:#333; border:1px solid #555; color:white; padding:20px 10px; border-radius:10px; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:10px; font-size:14px; text-align:center; }
        .menu-btn i { font-size:24px; }
        
        /* SMART LENS */
        .lens-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:20px 0; }
        .lens-btn { background:#333; border:2px solid #555; color:#aaa; padding:15px 5px; border-radius:10px; cursor:pointer; text-align:center; font-size:13px; }
        .lens-btn.active { background:#d4af37; color:black; border-color:#ffd700; font-weight:bold; }
        .lens-actions { display:flex; justify-content:space-between; margin-top:20px; }
        .lens-action-btn { background:#444; color:white; padding:12px 20px; border-radius:8px; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:5px; flex:1; margin:0 5px; }
        
        /* MIC CONTROLS */
        #mic-container { position:fixed; bottom:40px; left:0; width:100%; display:flex; flex-direction:column; align-items:center; z-index:50; }
        #status { background:rgba(0,0,0,0.7); color:white; padding:8px 20px; border-radius:20px; margin-bottom:15px; font-size:14px; }
        .mic-controls { display:flex; gap:20px; align-items:center; }
        .mic-btn { width:80px; height:80px; border-radius:50%; background:#ff4500; border:4px solid rgba(255,255,255,0.3); color:white; font-size:32px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
        .stop-btn { width:60px; height:60px; border-radius:50%; background:#444; border:2px solid #666; color:white; font-size:24px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
        .listening { animation:pulse 1.5s infinite; background:red !important; }
        @keyframes pulse { 0% { transform:scale(1); } 50% { transform:scale(1.05); } 100% { transform:scale(1); } }
        
        /* CAMERA & IMAGE */
        #camera-video { display:none; position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:120; }
        #camera-canvas { display:none; }
        #image-view { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:130; flex-direction:column; justify-content:center; align-items:center; }
        #viewed-image { max-width:90%; max-height:70vh; border-radius:10px; border:3px solid #ff4500; }
        
        /* INPUTS */
        input, select, textarea { width:100%; padding:10px; margin:5px 0; background:#333; border:1px solid #555; color:white; border-radius:5px; }
        button { cursor:pointer; }
        .btn { padding:10px 20px; background:#ff4500; color:white; border:none; border-radius:5px; font-weight:bold; }
        .btn-secondary { background:#444; }
        .btn-success { background:#28a745; }
        .btn-danger { background:#dc3545; }
        
        /* HIDDEN */
        .hidden { display:none !important; }
    </style>
</head>
<body>
    <!-- STATUS BARS -->
    <div id="rag-status">ğŸ“„ RAG: Off</div>
    <div id="memory-status">ğŸ’¾ àª®à«‡àª®àª°à«€: 0</div>
    
    <!-- VIDEO BACKGROUND -->
    <div id="video-container">
        <video id="silent-video" autoplay muted loop playsinline><source src="silent.mp4" type="video/mp4"></video>
        <video id="talking-video" muted loop playsinline><source src="talking.mp4" type="video/mp4"></video>
        <video id="thinking-video" muted loop playsinline><source src="thinking.mp4" type="video/mp4"></video>
    </div>
    
    <!-- CAMERA -->
    <video id="camera-video" autoplay playsinline></video>
    <canvas id="camera-canvas"></canvas>
    
    <!-- FILE INPUTS -->
    <input type="file" id="file-input" accept="image/*" class="hidden">
    <input type="file" id="doc-input" accept=".txt,.pdf,.doc,.docx" class="hidden">
    
    <!-- SETTINGS BUTTON -->
    <button class="side-btn" onclick="openModal('settings')"><i class="fas fa-cog"></i></button>
    
    <!-- SETTINGS MODAL -->
    <div id="settings" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-cog"></i> àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</div>
                <div class="close-btn" onclick="closeModal('settings')">Ã—</div>
            </div>
            
            <div class="menu-grid">
                <div class="menu-btn" onclick="openModal('notes')">
                    <i class="fas fa-book" style="color:orange;"></i>
                    <span>àª¨à«‹àª‚àª§</span>
                </div>
                <div class="menu-btn" onclick="openModal('music')">
                    <i class="fas fa-music" style="color:#00e5ff;"></i>
                    <span>àª­àªœàª¨</span>
                </div>
                <div class="menu-btn" onclick="openModal('lens')">
                    <i class="fas fa-eye" style="color:#d4af37;"></i>
                    <span>Smart Lens</span>
                </div>
                <div class="menu-btn" onclick="openModal('documents')">
                    <i class="fas fa-file-alt" style="color:#ff4081;"></i>
                    <span>àª¦àª¸à«àª¤àª¾àªµà«‡àªœà«‹</span>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">àªµà«àª¯àª•à«àª¤àª¿àª—àª¤</div>
                <input type="text" id="username" placeholder="àª¤àª®àª¾àª°à«àª‚ àª¨àª¾àª®" value="àª¸àª¾àª¹à«‡àª¬">
            </div>
            
            <div class="settings-section">
                <div class="section-title">AI API àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</div>
                <select id="ai-provider" onchange="toggleProviderSettings()">
                    <option value="gemini">Google Gemini</option>
                    <option value="groq">Groq</option>
                </select>
                
                <div id="gemini-settings">
                    <select id="gemini-model" style="margin-top:10px;">
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-flash-8b">Gemini Flash 8B</option>
                        <option value="gemini-pro">Gemini Pro</option>
                    </select>
                    <textarea id="gemini-key" placeholder="Gemini API Key (àª…àª²à«àªªàªµàª¿àª°àª¾àª®àª¥à«€ àª…àª²àª— àª•àª°à«‹)" rows="3" style="margin-top:10px;"></textarea>
                </div>
                
                <div id="groq-settings" class="hidden">
                    <select id="groq-model" style="margin-top:10px;">
                        <option value="llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                        <option value="llama-3.3-70b-versatile">Llama 3.3 70B Versatile</option>
                        <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                        <option value="gemma2-9b-it">Gemma2 9B</option>
                    </select>
                    <input type="password" id="groq-key" placeholder="Groq API Key" style="margin-top:10px;">
                </div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">Firebase àª¸à«‡àªŸàª¿àª‚àª—à«àª¸</div>
                <input type="password" id="firebase-key" placeholder="Firebase API Key (àªœàª°à«‚àª°à«€ àª¨àª¥à«€)" value="AIzaSyDummyKeyForInitialLoad">
                <div style="color:#aaa; font-size:11px; margin-top:5px;">
                    àª¤àª®à«‡ àª† àª•à«€ àªµàª¿àª¨àª¾ àªªàª£ àªàªª àªµàª¾àªªàª°à«€ àª¶àª•à«‹ àª›à«‹. àª¸àª¿àª‚àª• àª®àª¾àªŸà«‡ àªœ àªœàª°à«‚àª°à«€.
                </div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">RAG àª®à«‡àª®àª°à«€</div>
                <div class="checkbox">
                    <span>ğŸ“š RAG àªàª•à«àªŸàª¿àªµ àª•àª°à«‹</span>
                    <input type="checkbox" id="rag-enabled" checked>
                </div>
                <div class="checkbox">
                    <span>ğŸ’¾ àª¸à«àª¥àª¿àª° àª®à«‡àª®àª°à«€</span>
                    <input type="checkbox" id="persistent-memory" checked>
                </div>
            </div>
            
            <button class="btn" onclick="saveSettings()" style="width:100%; margin-top:20px;">àª¸à«‡àªµ àª•àª°à«‹</button>
        </div>
    </div>
    
    <!-- DOCUMENTS MODAL -->
    <div id="documents" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-file-alt"></i> àª¦àª¸à«àª¤àª¾àªµà«‡àªœà«‹</div>
                <div class="close-btn" onclick="closeModal('documents')">Ã—</div>
            </div>
            
            <button class="btn" onclick="document.getElementById('doc-input').click()" style="width:100%; margin-bottom:15px;">
                <i class="fas fa-upload"></i> àª¦àª¸à«àª¤àª¾àªµà«‡àªœ àª…àªªàª²à«‹àª¡ àª•àª°à«‹
            </button>
            
            <div id="document-list" style="max-height:300px; overflow-y:auto;">
                <!-- Documents will appear here -->
            </div>
        </div>
    </div>
    
    <!-- SMART LENS MODAL -->
    <div id="lens" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-eye"></i> Smart Lens</div>
                <div class="close-btn" onclick="closeModal('lens')">Ã—</div>
            </div>
            
            <div style="text-align:center; margin-bottom:20px;">àª¤àª®àª¾àª°à«‡ àª¶à«àª‚ àª¸à«àª•à«‡àª¨ àª•àª°àªµà«àª‚ àª›à«‡?</div>
            
            <div class="lens-grid">
                <div class="lens-btn active" onclick="setLensMode('object', this)">ğŸŒ¿ àª“àª³àª–</div>
                <div class="lens-btn" onclick="setLensMode('text', this)">ğŸ“œ àªŸà«‡àª•à«àª¸à«àªŸ</div>
                <div class="lens-btn" onclick="setLensMode('math', this)">ğŸ”¢ àª—àª£àª¿àª¤</div>
                <div class="lens-btn" onclick="setLensMode('translate', this)">ğŸŒ àª­àª¾àª·àª¾àª‚àª¤àª°</div>
                <div class="lens-btn" onclick="setLensMode('document', this)">ğŸ“„ àª¦àª¸à«àª¤àª¾àªµà«‡àªœ</div>
                <div class="lens-btn" onclick="setLensMode('summary', this)">ğŸ“ àª¸àª¾àª°àª¾àª‚àª¶</div>
            </div>
            
            <div class="lens-actions">
                <div class="lens-action-btn" onclick="openCamera()">
                    <i class="fas fa-camera" style="color:#00ccff; font-size:24px;"></i>
                    <span style="font-size:12px;">àª•à«‡àª®à«‡àª°à«‹</span>
                </div>
                <div class="lens-action-btn" onclick="openGallery()">
                    <i class="fas fa-image" style="color:#00ff88; font-size:24px;"></i>
                    <span style="font-size:12px;">àª—à«‡àª²à«‡àª°à«€</span>
                </div>
                <div class="lens-action-btn" onclick="closeModal('lens')">
                    <i class="fas fa-times" style="color:#ff5555; font-size:24px;"></i>
                    <span style="font-size:12px;">àª¬àª‚àª§</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- NOTES MODAL -->
    <div id="notes" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-book"></i> àª¨à«‹àª‚àª§</div>
                <div class="close-btn" onclick="closeModal('notes')">Ã—</div>
            </div>
            
            <input type="text" id="note-input" placeholder="àª¨àªµà«€ àª¨à«‹àª‚àª§ àª²àª–à«‹..." style="margin-bottom:15px;">
            <button onclick="addNote()" class="btn" style="width:100%; margin-bottom:20px;">àª‰àª®à«‡àª°à«‹</button>
            
            <div id="notes-list" style="max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>
    
    <!-- IMAGE VIEW -->
    <div id="image-view">
        <img id="viewed-image" src="" alt="">
        <div id="image-analysis" style="color:white; margin-top:20px; padding:15px; background:rgba(0,0,0,0.5); border-radius:10px; max-width:90%; display:none;"></div>
        <button onclick="closeImageView()" class="btn btn-danger" style="margin-top:20px;">
            <i class="fas fa-times"></i> àª¬àª‚àª§ àª•àª°à«‹
        </button>
    </div>
    
    <!-- MIC CONTROLS -->
    <div id="mic-container">
        <div id="status">àª®àª¾àªˆàª• àª¦àª¬àª¾àªµà«‹</div>
        <div class="mic-controls">
            <button class="stop-btn" onclick="stopSpeaking()" title="àªµàª¾àª¤ àª¬àª‚àª§ àª•àª°à«‹">
                <i class="fas fa-stop"></i>
            </button>
            <button id="mic-main-btn" class="mic-btn" onclick="toggleMic()">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentVideo = 'silent';
        let userName = 'àª¸àª¾àª¹à«‡àª¬';
        let isListening = false;
        let isSpeaking = false;
        let lensMode = 'object';
        let cameraStream = null;
        let ragEnabled = true;
        let aiProvider = 'gemini';
        let geminiModel = 'gemini-2.5-flash';
        let groqModel = 'llama-3.1-8b-instant';
        
        // Videos
        const videos = {
            silent: document.getElementById('silent-video'),
            talking: document.getElementById('talking-video'),
            thinking: document.getElementById('thinking-video')
        };
        
        // ==================== CORE FUNCTIONS ====================
        function playVideo(type) {
            if(currentVideo === type) return;
            currentVideo = type;
            
            Object.values(videos).forEach(v => {
                v.style.display = 'none';
                v.pause();
            });
            
            if(videos[type]) {
                videos[type].style.display = 'block';
                videos[type].play().catch(e => console.log('Video play error:', e));
            }
        }
        
        function speak(text) {
            if(!text) return;
            
            // Stop any current speech
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'gu-IN';
            utterance.rate = 1.0;
            utterance.volume = 1.0;
            
            utterance.onstart = () => {
                isSpeaking = true;
                document.getElementById('status').textContent = 'àª¬à«‹àª²à«àª‚ àª›à«àª‚...';
                playVideo('talking');
            };
            
            utterance.onend = () => {
                isSpeaking = false;
                document.getElementById('status').textContent = 'àª¤à«ˆàª¯àª¾àª° àª›à«àª‚';
                playVideo('silent');
            };
            
            utterance.onerror = (e) => {
                console.error('Speech error:', e);
                isSpeaking = false;
                document.getElementById('status').textContent = 'àª¤à«ˆàª¯àª¾àª° àª›à«àª‚';
                playVideo('silent');
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        function stopSpeaking() {
            window.speechSynthesis.cancel();
            isSpeaking = false;
            document.getElementById('status').textContent = 'àª°à«‹àª•àª¾àª¯à«àª‚';
            playVideo('silent');
            speak('àª¬àª‚àª§ àª•àª°à«àª¯à«àª‚.');
        }
        
        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            if(modalId === 'notes') loadNotes();
            if(modalId === 'documents') loadDocuments();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function toggleProviderSettings() {
            const provider = document.getElementById('ai-provider').value;
            if(provider === 'gemini') {
                document.getElementById('gemini-settings').classList.remove('hidden');
                document.getElementById('groq-settings').classList.add('hidden');
            } else {
                document.getElementById('gemini-settings').classList.add('hidden');
                document.getElementById('groq-settings').classList.remove('hidden');
            }
        }
        
        function saveSettings() {
            // Save personal settings
            userName = document.getElementById('username').value || 'àª¸àª¾àª¹à«‡àª¬';
            localStorage.setItem('vidushi_username', userName);
            
            // Save AI provider settings
            aiProvider = document.getElementById('ai-provider').value;
            geminiModel = document.getElementById('gemini-model').value;
            groqModel = document.getElementById('groq-model').value;
            
            localStorage.setItem('vidushi_ai_provider', aiProvider);
            localStorage.setItem('vidushi_gemini_model', geminiModel);
            localStorage.setItem('vidushi_groq_model', groqModel);
            
            // Save API keys
            const geminiKey = document.getElementById('gemini-key').value;
            const groqKey = document.getElementById('groq-key').value;
            const firebaseKey = document.getElementById('firebase-key').value;
            
            if(geminiKey) localStorage.setItem('vidushi_gemini_key', geminiKey);
            if(groqKey) localStorage.setItem('vidushi_groq_key', groqKey);
            if(firebaseKey && firebaseKey !== 'AIzaSyDummyKeyForInitialLoad') {
                localStorage.setItem('vidushi_firebase_key', firebaseKey);
            }
            
            // Save RAG settings
            ragEnabled = document.getElementById('rag-enabled').checked;
            const persistentMemory = document.getElementById('persistent-memory').checked;
            
            localStorage.setItem('vidushi_rag_enabled', ragEnabled);
            localStorage.setItem('vidushi_persistent_memory', persistentMemory);
            
            speak('àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª¸à«‡àªµ àª¥àª¯àª¾.');
            closeModal('settings');
        }
        
        function loadSettings() {
            // Load personal settings
            userName = localStorage.getItem('vidushi_username') || 'àª¸àª¾àª¹à«‡àª¬';
            document.getElementById('username').value = userName;
            
            // Load AI settings
            aiProvider = localStorage.getItem('vidushi_ai_provider') || 'gemini';
            geminiModel = localStorage.getItem('vidushi_gemini_model') || 'gemini-2.5-flash';
            groqModel = localStorage.getItem('vidushi_groq_model') || 'llama-3.1-8b-instant';
            
            document.getElementById('ai-provider').value = aiProvider;
            document.getElementById('gemini-model').value = geminiModel;
            document.getElementById('groq-model').value = groqModel;
            
            // Load API keys
            document.getElementById('gemini-key').value = localStorage.getItem('vidushi_gemini_key') || '';
            document.getElementById('groq-key').value = localStorage.getItem('vidushi_groq_key') || '';
            document.getElementById('firebase-key').value = localStorage.getItem('vidushi_firebase_key') || 'AIzaSyDummyKeyForInitialLoad';
            
            // Load RAG settings
            ragEnabled = localStorage.getItem('vidushi_rag_enabled') !== 'false';
            document.getElementById('rag-enabled').checked = ragEnabled;
            document.getElementById('persistent-memory').checked = localStorage.getItem('vidushi_persistent_memory') !== 'false';
            
            // Update UI
            toggleProviderSettings();
            updateStatusBars();
        }
        
        function updateStatusBars() {
            const ragStatus = document.getElementById('rag-status');
            const memoryStatus = document.getElementById('memory-status');
            
            if(ragEnabled) {
                ragStatus.textContent = 'ğŸ“„ RAG: On';
                ragStatus.style.display = 'block';
                ragStatus.style.background = 'rgba(0,140,255,0.8)';
            } else {
                ragStatus.textContent = 'ğŸ“„ RAG: Off';
                ragStatus.style.display = 'block';
                ragStatus.style.background = 'rgba(255,100,0,0.8)';
            }
            
            // Load memory count
            const memories = JSON.parse(localStorage.getItem('vidushi_memories') || '[]');
            memoryStatus.textContent = `ğŸ’¾ àª®à«‡àª®àª°à«€: ${memories.length}`;
            memoryStatus.style.display = 'block';
        }
        
        // ==================== NOTES FUNCTIONS ====================
        function loadNotes() {
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            
            if(notes.length === 0) {
                list.innerHTML = '<div style="color:#aaa; text-align:center; padding:20px;">àª•à«‹àªˆ àª¨à«‹àª‚àª§ àª¨àª¥à«€</div>';
                return;
            }
            
            notes.forEach((note, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'background:#333; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center;';
                div.innerHTML = `
                    <div>${note}</div>
                    <button onclick="deleteNote(${index})" style="background:red; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">Ã—</button>
                `;
                list.appendChild(div);
            });
        }
        
        function addNote() {
            const input = document.getElementById('note-input');
            const text = input.value.trim();
            if(!text) return;
            
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            notes.push(text);
            localStorage.setItem('vidushi_notes', JSON.stringify(notes));
            
            // Add to memory if RAG enabled
            if(ragEnabled) {
                const memories = JSON.parse(localStorage.getItem('vidushi_memories') || '[]');
                memories.push({
                    text: `àª¨à«‹àª‚àª§: ${text}`,
                    type: 'note',
                    date: new Date().toISOString()
                });
                localStorage.setItem('vidushi_memories', JSON.stringify(memories));
                updateStatusBars();
            }
            
            input.value = '';
            loadNotes();
            speak('àª¨à«‹àª‚àª§ àª‰àª®à«‡àª°à«€.');
        }
        
        function deleteNote(index) {
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            notes.splice(index, 1);
            localStorage.setItem('vidushi_notes', JSON.stringify(notes));
            loadNotes();
        }
        
        // ==================== DOCUMENT FUNCTIONS ====================
        function loadDocuments() {
            const docs = JSON.parse(localStorage.getItem('vidushi_documents') || '[]');
            const list = document.getElementById('document-list');
            list.innerHTML = '';
            
            if(docs.length === 0) {
                list.innerHTML = '<div style="color:#aaa; text-align:center; padding:20px;">àª•à«‹àªˆ àª¦àª¸à«àª¤àª¾àªµà«‡àªœà«‹ àª¨àª¥à«€</div>';
                return;
            }
            
            docs.forEach((doc, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'background:#333; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center;';
                div.innerHTML = `
                    <div>
                        <div style="color:#fff;">${doc.name}</div>
                        <div style="color:#888; font-size:11px;">${new Date(doc.date).toLocaleDateString('gu-IN')}</div>
                    </div>
                    <button onclick="deleteDocument(${index})" style="background:red; color:white; border:none; border-radius:5px; padding:5px 10px; cursor:pointer;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                list.appendChild(div);
            });
        }
        
        document.getElementById('doc-input').onchange = function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const docs = JSON.parse(localStorage.getItem('vidushi_documents') || '[]');
                docs.push({
                    name: file.name,
                    content: event.target.result.substring(0, 5000),
                    date: new Date().toISOString(),
                    type: file.type
                });
                
                localStorage.setItem('vidushi_documents', JSON.stringify(docs));
                loadDocuments();
                speak(`${file.name} àª…àªªàª²à«‹àª¡ àª¥àª¯à«‹.`);
            };
            
            reader.readAsText(file);
        };
        
        function deleteDocument(index) {
            const docs = JSON.parse(localStorage.getItem('vidushi_documents') || '[]');
            docs.splice(index, 1);
            localStorage.setItem('vidushi_documents', JSON.stringify(docs));
            loadDocuments();
        }
        
        // ==================== SMART LENS FUNCTIONS ====================
        function setLensMode(mode, element) {
            document.querySelectorAll('.lens-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            lensMode = mode;
        }
        
        function openCamera() {
            closeModal('lens');
            document.getElementById('status').textContent = 'àª•à«‡àª®à«‡àª°àª¾ àª–à«‹àª²à«àª‚ àª›à«àª‚...';
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('camera-video');
                    video.srcObject = stream;
                    video.style.display = 'block';
                    playVideo('silent');
                    
                    // Capture after 3 seconds
                    setTimeout(captureImage, 3000);
                })
                .catch(error => {
                    console.error('Camera error:', error);
                    speak('àª•à«‡àª®à«‡àª°àª¾àª¨à«€ àªªàª°àª®àª¿àª¶àª¨ àª¨àª¥à«€.');
                });
        }
        
        function captureImage() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Stop camera
            if(cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            video.style.display = 'none';
            
            // Convert to data URL and show
            const dataUrl = canvas.toDataURL('image/jpeg');
            showImage(dataUrl);
            analyzeImage(dataUrl);
        }
        
        function openGallery() {
            closeModal('lens');
            document.getElementById('file-input').click();
        }
        
        document.getElementById('file-input').onchange = function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                showImage(event.target.result);
                analyzeImage(event.target.result);
            };
            reader.readAsDataURL(file);
        };
        
        function showImage(dataUrl) {
            document.getElementById('viewed-image').src = dataUrl;
            document.getElementById('image-view').style.display = 'flex';
        }
        
        function closeImageView() {
            document.getElementById('image-view').style.display = 'none';
            document.getElementById('image-analysis').style.display = 'none';
        }
        
        function analyzeImage(dataUrl) {
            document.getElementById('status').textContent = 'àªµàª¿àª¶à«àª²à«‡àª·àª£ àª•àª°à«àª‚ àª›à«àª‚...';
            playVideo('thinking');
            
            setTimeout(() => {
                const analysis = getMockAnalysis(lensMode);
                document.getElementById('image-analysis').innerHTML = analysis;
                document.getElementById('image-analysis').style.display = 'block';
                
                // Add to memory if RAG enabled
                if(ragEnabled && lensMode === 'document') {
                    const memories = JSON.parse(localStorage.getItem('vidushi_memories') || '[]');
                    memories.push({
                        text: `àªšàª¿àª¤à«àª° àªµàª¿àª¶à«àª²à«‡àª·àª£ (${lensMode}): ${analysis.substring(0, 100)}`,
                        type: 'vision',
                        date: new Date().toISOString()
                    });
                    localStorage.setItem('vidushi_memories', JSON.stringify(memories));
                    updateStatusBars();
                }
                
                speak(analysis);
            }, 2000);
        }
        
        function getMockAnalysis(mode) {
            const analyses = {
                object: 'ğŸ“¸ àª† àªšàª¿àª¤à«àª°àª®àª¾àª‚ àªàª• àªµà«àª¯àª•à«àª¤àª¿ àªœà«‹àªµàª¾ àª®àª³à«‡ àª›à«‡. àªªà«àª°à«àª·, àª®àª§à«àª¯àª® àªµàª¯, àª¸à«àª®àª¿àª¤ àª•àª°àª¤àª¾.',
                text: 'ğŸ“œ àª† àªšàª¿àª¤à«àª°àª®àª¾àª‚ àª—à«àªœàª°àª¾àª¤à«€ àª²àª¿àªªàª¿: "àªœàª¯ àª¶à«àª°à«€ àª•à«ƒàª·à«àª£".',
                math: 'ğŸ”¢ àª† àªšàª¿àª¤à«àª°àª®àª¾àª‚ àª—àª£àª¿àª¤: à«¨ + à«¨ = à«ª.',
                translate: 'ğŸŒ "Hello World" â†’ "àª¹à«‡àª²à«‹ àªµàª°à«àª²à«àª¡".',
                document: 'ğŸ“„ àª† àª¦àª¸à«àª¤àª¾àªµà«‡àªœàª®àª¾àª‚ àª®à«àª–à«àª¯ àª®à«àª¦à«àª¦àª¾àª“ àª›à«‡.',
                summary: 'ğŸ“ àª† àªŸà«‡àª•à«àª¸à«àªŸàª¨à«‹ àª¸àª¾àª°àª¾àª‚àª¶: àª®à«àª–à«àª¯ àªµàª¿àªšàª¾àª°à«‹ àª¸àª®àªœàª¾àªµà«‡ àª›à«‡.'
            };
            return analyses[mode] || 'àªµàª¿àª¶à«àª²à«‡àª·àª£ àª®àª³à«àª¯à«àª‚ àª¨àª¥à«€.';
        }
        
        // ==================== VOICE RECOGNITION ====================
        let recognition = null;
        if('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'gu-IN';
            
            recognition.onstart = () => {
                isListening = true;
                document.getElementById('status').textContent = 'àª¸àª¾àª‚àª­àª³à«àª‚ àª›à«àª‚...';
                document.getElementById('mic-main-btn').classList.add('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('status').textContent = 'àªµàª¿àªšàª¾àª°à«àª‚ àª›à«àª‚...';
                processVoiceCommand(transcript);
            };
            
            recognition.onend = () => {
                isListening = false;
                document.getElementById('mic-main-btn').classList.remove('listening');
                document.getElementById('status').textContent = 'àª¤à«ˆàª¯àª¾àª° àª›à«àª‚';
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                document.getElementById('mic-main-btn').classList.remove('listening');
                document.getElementById('status').textContent = 'àª­à«‚àª² àª¥àªˆ';
            };
        }
        
        function toggleMic() {
            if(!recognition) {
                speak('àªµà«‰àª‡àª¸ àª°à«‡àª•à«‹àª—à«àª¨àª¿àª¶àª¨ àª¸àªªà«‹àª°à«àªŸ àª¨àª¥à«€.');
                return;
            }
            
            if(isListening) {
                recognition.stop();
            } else {
                if(isSpeaking) {
                    stopSpeaking();
                    setTimeout(() => recognition.start(), 500);
                } else {
                    recognition.start();
                }
            }
        }
        
        function processVoiceCommand(command) {
            console.log('Command:', command);
            const cmd = command.toLowerCase();
            
            playVideo('thinking');
            
            if(cmd.includes('àª¨àª®àª¸à«àª¤à«‡') || cmd.includes('àª¹à«‡àª²à«‹')) {
                speak(`àª¨àª®àª¸à«àª¤à«‡ ${userName}! àª¹à«àª‚ àªµàª¿àª¦à«àª·à«€.`);
            }
            else if(cmd.includes('àª¸à«àª®àª¾àª°à«àªŸ àª²à«‡àª¨à«àª¸') || cmd.includes('àª•à«‡àª®à«‡àª°àª¾')) {
                openModal('lens');
                speak('àª¸à«àª®àª¾àª°à«àªŸ àª²à«‡àª¨à«àª¸ àª–à«‹àª²à«àª‚ àª›à«àª‚.');
            }
            else if(cmd.includes('àª«à«‹àªŸà«‹ àª²à«‹')) {
                openCamera();
            }
            else if(cmd.includes('àª¨à«‹àª‚àª§')) {
                openModal('notes');
                speak('àª¨à«‹àª‚àª§ àª–à«‹àª²à«àª‚ àª›à«àª‚.');
            }
            else if(cmd.includes('àª¦àª¸à«àª¤àª¾àªµà«‡àªœ')) {
                openModal('documents');
                speak('àª¦àª¸à«àª¤àª¾àªµà«‡àªœà«‹ àª–à«‹àª²à«àª‚ àª›à«àª‚.');
            }
            else if(cmd.includes('àª¬àª‚àª§ àª•àª°') || cmd.includes('àª¸à«àªŸà«‹àªª')) {
                stopSpeaking();
            }
            else if(cmd.includes('àª¸à«‡àªŸàª¿àª‚àª—')) {
                openModal('settings');
                speak('àª¸à«‡àªŸàª¿àª‚àª—à«àª¸ àª–à«‹àª²à«àª‚ àª›à«àª‚.');
            }
            else if(cmd.includes('àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆàª¨à«‹ àª«à«‹àªŸà«‹')) {
                speak('àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆàª¨à«‹ àª«à«‹àªŸà«‹ àª¬àª¤àª¾àªµà«àª‚ àª›à«àª‚.');
                showImage('https://via.placeholder.com/300x400/FFA500/000000?text=àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ');
                setTimeout(() => {
                    document.getElementById('image-analysis').innerHTML = 'ğŸ‘¤ àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ - àªªàª°àª¿àªµàª¾àª°àª¨àª¾ àª®à«àª–à«àª¯';
                    document.getElementById('image-analysis').style.display = 'block';
                }, 500);
            }
            else {
                speak(`àª¤àª®à«‡ àª•àª¹à«àª¯à«àª‚: ${command}. àª¹à«àª‚ àª¹àªœà« àª¶à«€àª–à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚.`);
            }
        }
        
        // ==================== INITIALIZATION ====================
        window.onload = () => {
            playVideo('silent');
            loadSettings();
            
            // Welcome message
            setTimeout(() => {
                if(!localStorage.getItem('vidushi_welcomed')) {
                    speak(`àª¨àª®àª¸à«àª¤à«‡ ${userName}! àª¹à«àª‚ àªµàª¿àª¦à«àª·à«€ àª¤àª®àª¾àª°à«€ àª¸à«‡àªµàª¾àª®àª¾àª‚.`);
                    localStorage.setItem('vidushi_welcomed', 'true');
                }
            }, 1500);
        };
    </script>
</body>
</html>
