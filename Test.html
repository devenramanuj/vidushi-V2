<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidushi AI - RAG Memory рк╕рк╛ркерлЗ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CORE STYLES */
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { width:100%; height:100%; overflow:hidden; background:black; font-family:'Segoe UI'; color:white; }
        
        /* VIDEO BACKGROUND */
        #video-container { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; }
        video { width:100%; height:100%; object-fit:cover; position:absolute; }
        #silent-video { display:block; }
        
        /* RAG STATUS */
        #rag-status { 
            position:fixed; 
            top:10px; 
            left:10px; 
            background:rgba(0,140,255,0.8); 
            color:white; 
            padding:5px 12px; 
            border-radius:15px; 
            font-size:12px; 
            z-index:10;
            display:none;
            backdrop-filter:blur(5px);
        }
        
        /* MEMORY STATUS */
        #memory-status { 
            position:fixed; 
            top:10px; 
            left:50%; 
            transform:translateX(-50%); 
            background:rgba(0,100,0,0.8); 
            color:#0f0; 
            padding:5px 15px; 
            border-radius:15px; 
            font-size:12px; 
            z-index:10;
            display:none;
            backdrop-filter:blur(5px);
        }
        
        /* BUTTONS */
        .side-btn { position:fixed; top:20px; right:20px; z-index:20; background:rgba(0,0,0,0.5); color:white; border:1px solid rgba(255,255,255,0.3); width:50px; height:50px; border-radius:50%; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(5px); }
        .side-btn:active { transform:scale(0.9); background:#ff4500; }
        
        /* MODALS */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:100; flex-direction:column; padding:20px; }
        .modal-content { background:#222; border-radius:15px; padding:20px; width:90%; max-width:400px; border:2px solid #ff4500; margin:auto; max-height:85vh; overflow-y:auto; }
        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #444; }
        .modal-title { color:#ff4500; font-size:22px; font-weight:bold; }
        .close-btn { color:white; font-size:28px; cursor:pointer; }
        
        /* SETTINGS SPECIFIC */
        .settings-section { margin:15px 0; padding-top:15px; border-top:1px solid #333; }
        .section-title { color:#aaa; font-size:12px; margin-bottom:10px; text-transform:uppercase; }
        .checkbox { display:flex; align-items:center; justify-content:space-between; margin:10px 0; padding:10px; background:#333; border-radius:8px; }
        .checkbox input { transform:scale(1.3); }
        
        /* MENU GRID */
        .menu-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:20px 0; }
        .menu-btn { background:#333; border:1px solid #555; color:white; padding:20px 10px; border-radius:10px; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:10px; font-size:14px; text-align:center; }
        .menu-btn i { font-size:24px; }
        
        /* SMART LENS */
        #lens-modal { z-index:150; }
        .lens-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:20px 0; }
        .lens-btn { background:#333; border:2px solid #555; color:#aaa; padding:15px 5px; border-radius:10px; cursor:pointer; text-align:center; font-size:13px; }
        .lens-btn.active { background:#d4af37; color:black; border-color:#ffd700; font-weight:bold; }
        .lens-actions { display:flex; justify-content:space-between; margin-top:20px; }
        .lens-action-btn { background:#444; color:white; padding:12px 20px; border-radius:8px; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:5px; flex:1; margin:0 5px; }
        
        /* MIC CONTROLS */
        #mic-container { position:fixed; bottom:40px; left:0; width:100%; display:flex; flex-direction:column; align-items:center; z-index:50; }
        #status { background:rgba(0,0,0,0.7); color:white; padding:8px 20px; border-radius:20px; margin-bottom:15px; font-size:14px; backdrop-filter:blur(5px); }
        #mic-btn { width:80px; height:80px; border-radius:50%; background:#ff4500; border:4px solid rgba(255,255,255,0.3); color:white; font-size:32px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
        
        /* CAMERA */
        #camera-video { display:none; position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:120; }
        #camera-canvas { display:none; }
        
        /* IMAGE VIEW */
        #image-view { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:130; flex-direction:column; justify-content:center; align-items:center; }
        #viewed-image { max-width:90%; max-height:70vh; border-radius:10px; border:3px solid #ff4500; }
        
        /* DOCUMENT UPLOAD */
        #document-list { max-height:200px; overflow-y:auto; margin:10px 0; }
        .doc-item { background:#333; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
        
        /* MEMORY VIEW */
        .memory-item { background:#1a1a1a; padding:10px; margin:5px 0; border-radius:5px; border-left:3px solid #00ff00; }
        .memory-text { color:#ddd; font-size:14px; }
        .memory-meta { color:#888; font-size:11px; margin-top:5px; }
        
        /* UTILITY */
        .hidden { display:none !important; }
        .center { text-align:center; }
        .mt-20 { margin-top:20px; }
        .mb-20 { margin-bottom:20px; }
        input, select, textarea { width:100%; padding:10px; margin:5px 0; background:#333; border:1px solid #555; color:white; border-radius:5px; }
        button { cursor:pointer; }
        .btn { padding:10px 20px; background:#ff4500; color:white; border:none; border-radius:5px; font-weight:bold; }
        .btn-secondary { background:#444; }
        .btn-success { background:#28a745; }
        .btn-danger { background:#dc3545; }
    </style>
</head>
<body>
    <!-- RAG STATUS -->
    <div id="rag-status">ЁЯУД RAG: Off</div>
    <div id="memory-status">ЁЯТ╛ ркорлЗркорк░рлА: 0</div>
    
    <!-- VIDEO BACKGROUND -->
    <div id="video-container">
        <video id="silent-video" autoplay muted loop playsinline><source src="silent.mp4" type="video/mp4"></video>
        <video id="talking-video" muted loop playsinline><source src="talking.mp4" type="video/mp4"></video>
        <video id="thinking-video" muted loop playsinline><source src="thinking.mp4" type="video/mp4"></video>
    </div>
    
    <!-- CAMERA -->
    <video id="camera-video" autoplay playsinline></video>
    <canvas id="camera-canvas"></canvas>
    
    <!-- FILE INPUTS -->
    <input type="file" id="file-input" accept="image/*" class="hidden">
    <input type="file" id="doc-input" accept=".txt,.pdf,.doc,.docx" class="hidden">
    
    <!-- SETTINGS BUTTON -->
    <button class="side-btn" onclick="openModal('settings')"><i class="fas fa-cog"></i></button>
    
    <!-- SETTINGS MODAL -->
    <div id="settings" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-cog"></i> рк╕рлЗркЯрк┐ркВркЧрлНрк╕</div>
                <div class="close-btn" onclick="closeModal('settings')">├Ч</div>
            </div>
            
            <div class="menu-grid">
                <div class="menu-btn" onclick="openModal('notes')">
                    <i class="fas fa-book" style="color:orange;"></i>
                    <span>ркирлЛркВркз</span>
                </div>
                <div class="menu-btn" onclick="openModal('music')">
                    <i class="fas fa-music" style="color:#00e5ff;"></i>
                    <span>ркнркЬрки</span>
                </div>
                <div class="menu-btn" onclick="openModal('lens')">
                    <i class="fas fa-eye" style="color:#d4af37;"></i>
                    <span>Smart Lens</span>
                </div>
                <div class="menu-btn" onclick="openModal('documents')">
                    <i class="fas fa-file-alt" style="color:#ff4081;"></i>
                    <span>ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ</span>
                </div>
                <div class="menu-btn" onclick="openModal('memory')">
                    <i class="fas fa-brain" style="color:#00ff88;"></i>
                    <span>ркорлЗркорк░рлА</span>
                </div>
                <div class="menu-btn" onclick="openModal('vanshavali')">
                    <i class="fas fa-globe" style="color:#008cff;"></i>
                    <span>рк╡ркВрк╢рк╛рк╡рк▓рлА</span>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">рк╡рлНркпркХрлНркдрк┐ркЧркд</div>
                <input type="text" id="username" placeholder="ркдркорк╛рк░рлБркВ ркирк╛рко" value="рк╕рк╛рк╣рлЗркм">
            </div>
            
            <div class="settings-section">
                <div class="section-title">RAG ркорлЗркорк░рлА рк╕рлЗркЯрк┐ркВркЧрлНрк╕</div>
                <div class="checkbox">
                    <span>ЁЯУЪ RAG ркПркХрлНркЯрк┐рк╡ ркХрк░рлЛ</span>
                    <input type="checkbox" id="rag-enabled" checked>
                </div>
                <div class="checkbox">
                    <span>ЁЯТ╛ рк╕рлНркерк┐рк░ ркорлЗркорк░рлА</span>
                    <input type="checkbox" id="persistent-memory" checked>
                </div>
                <div class="checkbox">
                    <span>ЁЯФД ркУркЯрлЛ рк░рлАркХрлЛрк▓</span>
                    <input type="checkbox" id="auto-recall" checked>
                </div>
                <div style="color:#aaa; font-size:11px; margin-top:10px;">
                    RAG (Retrieval Augmented Generation) ркдркорк╛рк░рк╛ ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркЕркирлЗ ркЪрк░рлНркЪрк╛ркерлА рк╢рлАркЦрлЗ ркЫрлЗ.
                </div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">AI API</div>
                <select id="ai-provider">
                    <option value="gemini">Google Gemini</option>
                    <option value="groq">Groq (Llama)</option>
                </select>
                <input type="password" id="api-key" placeholder="API Key" style="margin-top:10px;">
            </div>
            
            <button class="btn" onclick="saveSettings()" style="width:100%; margin-top:20px;">рк╕рлЗрк╡ ркХрк░рлЛ</button>
        </div>
    </div>
    
    <!-- DOCUMENTS MODAL (RAG) -->
    <div id="documents" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-file-alt"></i> RAG ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ</div>
                <div class="close-btn" onclick="closeModal('documents')">├Ч</div>
            </div>
            
            <div style="margin:15px 0;">
                <div style="color:#0f0; margin-bottom:10px;">ЁЯУК RAG рк╕рлНркЯрлЗркЯрк╕: <span id="rag-stats">0 ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ</span></div>
                <button class="btn" onclick="document.getElementById('doc-input').click()" style="width:100%;">
                    <i class="fas fa-upload"></i> ркжрк╕рлНркдрк╛рк╡рлЗркЬ ркЕрккрк▓рлЛркб ркХрк░рлЛ
                </button>
                <div style="color:#aaa; font-size:12px; margin-top:10px;">
                    PDF, TXT, Word рклрк╛ркИрк▓рлЛ ркЕрккрк▓рлЛркб ркХрк░рлЛ. AI ркЖркорк╛ркВркерлА ркЬрк╡рк╛ркмрлЛ ркЖрккрк╢рлЗ.
                </div>
            </div>
            
            <div id="document-list">
                <!-- Documents will appear here -->
            </div>
            
            <button class="btn btn-secondary" onclick="clearRAGDocuments()" style="width:100%; margin-top:15px;">
                <i class="fas fa-trash"></i> ркмркзрк╛ ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ рк╕рк╛ркл ркХрк░рлЛ
            </button>
        </div>
    </div>
    
    <!-- MEMORY MODAL -->
    <div id="memory" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-brain"></i> ркорлЗркорк░рлА рк╕рк┐рк╕рлНркЯрко</div>
                <div class="close-btn" onclick="closeModal('memory')">├Ч</div>
            </div>
            
            <div style="text-align:center; margin:20px 0;">
                <div style="font-size:48px; color:#00ff00;">ЁЯТ╛</div>
                <div style="color:#0f0; font-size:20px;" id="memory-count">0 ркпрк╛ркжрлЛ</div>
                <div style="color:#aaa; font-size:14px;">RAG ркорлЗркорк░рлА рк╕рк┐рк╕рлНркЯрко</div>
            </div>
            
            <div class="settings-section">
                <div class="section-title">ркорлЗркорк░рлА рк╕рлЗркЯрк┐ркВркЧрлНрк╕</div>
                <div class="checkbox">
                    <span>ЁЯза рк▓рк░рлНркирк┐ркВркЧ ркорлЛркб</span>
                    <input type="checkbox" id="learning-mode" checked>
                </div>
                <div class="checkbox">
                    <span>ЁЯУЦ ркХрлЛркирлНркЯрлЗркХрлНркЯ рк╕рлЗрк╡</span>
                    <input type="checkbox" id="save-context" checked>
                </div>
                <div class="checkbox">
                    <span>тЪб ркХрлНрк╡рк┐ркХ рк░рлАркХрлЛрк▓</span>
                    <input type="checkbox" id="quick-recall" checked>
                </div>
            </div>
            
            <div style="margin:20px 0;">
                <div class="section-title">ркорлЗркорк░рлА ркПркХрлНрк╢ркирлНрк╕</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <button class="btn btn-success" onclick="backupMemory()">
                        <i class="fas fa-save"></i> ркмрлЗркХркЕркк
                    </button>
                    <button class="btn btn-danger" onclick="clearMemory()">
                        <i class="fas fa-trash"></i> ркХрлНрк▓рлАркпрк░
                    </button>
                </div>
            </div>
            
            <div id="memory-view" style="max-height:200px; overflow-y:auto; margin-top:10px;">
                <!-- Memories will appear here -->
            </div>
        </div>
    </div>
    
    <!-- SMART LENS MODAL -->
    <div id="lens" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-eye"></i> Smart Lens</div>
                <div class="close-btn" onclick="closeModal('lens')">├Ч</div>
            </div>
            <div class="center mb-20">ркдркорк╛рк░рлЗ рк╢рлБркВ рк╕рлНркХрлЗрки ркХрк░рк╡рлБркВ ркЫрлЗ?</div>
            <div class="lens-grid">
                <div class="lens-btn active" onclick="setLensMode('object', this)">ЁЯМ┐ ркУрк│ркЦ</div>
                <div class="lens-btn" onclick="setLensMode('text', this)">ЁЯУЬ ркЯрлЗркХрлНрк╕рлНркЯ</div>
                <div class="lens-btn" onclick="setLensMode('math', this)">ЁЯФв ркЧркгрк┐ркд</div>
                <div class="lens-btn" onclick="setLensMode('translate', this)">ЁЯМР ркнрк╛рк╖рк╛ркВркдрк░</div>
                <div class="lens-btn" onclick="setLensMode('document', this)">ЁЯУД ркжрк╕рлНркдрк╛рк╡рлЗркЬ</div>
                <div class="lens-btn" onclick="setLensMode('memory', this)">ЁЯза ркорлЗркорк░рлА</div>
            </div>
            <div class="lens-actions">
                <div class="lens-action-btn" onclick="openCamera()">
                    <i class="fas fa-camera" style="color:#00ccff; font-size:24px;"></i>
                    <span style="font-size:12px;">ркХрлЗркорлЗрк░рлЛ</span>
                </div>
                <div class="lens-action-btn" onclick="openGallery()">
                    <i class="fas fa-image" style="color:#00ff88; font-size:24px;"></i>
                    <span style="font-size:12px;">ркЧрлЗрк▓рлЗрк░рлА</span>
                </div>
                <div class="lens-action-btn" onclick="closeModal('lens')">
                    <i class="fas fa-times" style="color:#ff5555; font-size:24px;"></i>
                    <span style="font-size:12px;">ркмркВркз</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- NOTES MODAL -->
    <div id="notes" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-book"></i> ркирлЛркВркз</div>
                <div class="close-btn" onclick="closeModal('notes')">├Ч</div>
            </div>
            <input type="text" id="note-input" placeholder="ркирк╡рлА ркирлЛркВркз рк▓ркЦрлЛ..." style="width:100%; padding:12px; background:#333; border:1px solid #555; color:white; border-radius:8px; margin-bottom:15px;">
            <button onclick="addNote()" style="width:100%; padding:12px; background:#ff4500; color:white; border:none; border-radius:8px; margin-bottom:20px; cursor:pointer;">ркЙркорлЗрк░рлЛ</button>
            <div id="notes-list" style="max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>
    
    <!-- IMAGE VIEW -->
    <div id="image-view">
        <img id="viewed-image" src="" alt="">
        <div id="image-analysis" style="color:white; margin-top:20px; padding:15px; background:rgba(0,0,0,0.5); border-radius:10px; max-width:90%; display:none;"></div>
        <button onclick="closeImageView()" style="margin-top:20px; padding:12px 30px; background:red; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">
            <i class="fas fa-times"></i> ркмркВркз ркХрк░рлЛ
        </button>
    </div>
    
    <!-- MIC CONTROLS -->
    <div id="mic-container">
        <div id="status">ркорк╛ркИркХ ркжркмрк╛рк╡рлЛ</div>
        <button id="mic-btn" onclick="toggleMic()"><i class="fas fa-microphone"></i></button>
    </div>

    <script>
        // ==================== RAG MEMORY SYSTEM ====================
        class RAGMemory {
            constructor() {
                this.documents = JSON.parse(localStorage.getItem('rag_documents') || '[]');
                this.memories = JSON.parse(localStorage.getItem('rag_memories') || '[]');
                this.settings = JSON.parse(localStorage.getItem('rag_settings') || '{"enabled":true,"persistent":true,"autoRecall":true}');
                this.conversationHistory = JSON.parse(localStorage.getItem('rag_conversations') || '[]');
                
                this.updateUI();
            }
            
            // Document management
            addDocument(name, content) {
                const doc = {
                    id: Date.now(),
                    name: name,
                    content: content.substring(0, 5000), // Limit content
                    date: new Date().toISOString(),
                    type: this.getFileType(name)
                };
                
                this.documents.push(doc);
                this.save();
                this.updateUI();
                return doc.id;
            }
            
            getFileType(filename) {
                if(filename.includes('.pdf')) return 'pdf';
                if(filename.includes('.txt')) return 'text';
                if(filename.includes('.doc')) return 'word';
                return 'other';
            }
            
            removeDocument(id) {
                this.documents = this.documents.filter(doc => doc.id !== id);
                this.save();
                this.updateUI();
            }
            
            clearDocuments() {
                this.documents = [];
                this.save();
                this.updateUI();
            }
            
            // Memory management
            addMemory(text, category = 'conversation', importance = 1) {
                const memory = {
                    id: Date.now(),
                    text: text,
                    category: category,
                    importance: importance,
                    date: new Date().toISOString(),
                    lastRecalled: new Date().toISOString(),
                    recallCount: 0
                };
                
                this.memories.push(memory);
                this.save();
                this.updateUI();
                return memory.id;
            }
            
            recallMemories(query, limit = 5) {
                if(!this.settings.autoRecall || !query) return [];
                
                const lowerQuery = query.toLowerCase();
                const relevant = this.memories.filter(mem => 
                    mem.text.toLowerCase().includes(lowerQuery) ||
                    lowerQuery.includes(mem.text.toLowerCase())
                );
                
                // Sort by importance and recency
                return relevant
                    .sort((a, b) => {
                        const scoreA = a.importance * (a.recallCount + 1);
                        const scoreB = b.importance * (b.recallCount + 1);
                        return scoreB - scoreA;
                    })
                    .slice(0, limit);
            }
            
            clearMemories() {
                this.memories = [];
                this.save();
                this.updateUI();
            }
            
            // Conversation history
            addConversation(userText, aiResponse) {
                this.conversationHistory.push({
                    user: userText,
                    ai: aiResponse,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 50 conversations
                if(this.conversationHistory.length > 50) {
                    this.conversationHistory = this.conversationHistory.slice(-50);
                }
                
                this.save();
            }
            
            // Search in all content
            search(query) {
                const results = {
                    documents: [],
                    memories: [],
                    conversations: []
                };
                
                const lowerQuery = query.toLowerCase();
                
                // Search documents
                results.documents = this.documents.filter(doc => 
                    doc.name.toLowerCase().includes(lowerQuery) ||
                    doc.content.toLowerCase().includes(lowerQuery)
                );
                
                // Search memories
                results.memories = this.memories.filter(mem => 
                    mem.text.toLowerCase().includes(lowerQuery)
                );
                
                // Search conversations
                results.conversations = this.conversationHistory.filter(conv => 
                    conv.user.toLowerCase().includes(lowerQuery) ||
                    conv.ai.toLowerCase().includes(lowerQuery)
                );
                
                return results;
            }
            
            // Update settings
            updateSettings(newSettings) {
                this.settings = {...this.settings, ...newSettings};
                this.save();
                this.updateUI();
            }
            
            // Save to localStorage
            save() {
                localStorage.setItem('rag_documents', JSON.stringify(this.documents));
                localStorage.setItem('rag_memories', JSON.stringify(this.memories));
                localStorage.setItem('rag_settings', JSON.stringify(this.settings));
                localStorage.setItem('rag_conversations', JSON.stringify(this.conversationHistory));
            }
            
            // Update UI
            updateUI() {
                // Update status indicators
                const ragStatus = document.getElementById('rag-status');
                const memoryStatus = document.getElementById('memory-status');
                
                if(this.settings.enabled) {
                    ragStatus.textContent = `ЁЯУД RAG: ${this.documents.length} ркбрлЛркХрлНрк╕`;
                    ragStatus.style.display = 'block';
                    ragStatus.style.background = 'rgba(0,140,255,0.8)';
                } else {
                    ragStatus.textContent = 'ЁЯУД RAG: Off';
                    ragStatus.style.display = 'block';
                    ragStatus.style.background = 'rgba(255,100,0,0.8)';
                }
                
                memoryStatus.textContent = `ЁЯТ╛ ркорлЗркорк░рлА: ${this.memories.length}`;
                memoryStatus.style.display = 'block';
                
                // Update memory count
                const memoryCount = document.getElementById('memory-count');
                if(memoryCount) {
                    memoryCount.textContent = `${this.memories.length} ркпрк╛ркжрлЛ`;
                }
                
                // Update RAG stats
                const ragStats = document.getElementById('rag-stats');
                if(ragStats) {
                    ragStats.textContent = `${this.documents.length} ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ, ${this.memories.length} ркпрк╛ркжрлЛ`;
                }
                
                // Update document list
                this.renderDocumentList();
                
                // Update memory view
                this.renderMemoryView();
            }
            
            renderDocumentList() {
                const list = document.getElementById('document-list');
                if(!list) return;
                
                if(this.documents.length === 0) {
                    list.innerHTML = '<div style="color:#aaa; text-align:center; padding:20px;">ркХрлЛркИ ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркиркерлА</div>';
                    return;
                }
                
                list.innerHTML = this.documents.map(doc => `
                    <div class="doc-item">
                        <div>
                            <div style="color:#fff;">${doc.name}</div>
                            <div style="color:#888; font-size:11px;">${new Date(doc.date).toLocaleDateString('gu-IN')} тАв ${doc.type}</div>
                        </div>
                        <button onclick="ragMemory.removeDocument(${doc.id})" style="background:red; color:white; border:none; border-radius:5px; padding:5px 10px; cursor:pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            renderMemoryView() {
                const view = document.getElementById('memory-view');
                if(!view) return;
                
                const recentMemories = this.memories.slice(-10).reverse();
                
                if(recentMemories.length === 0) {
                    view.innerHTML = '<div style="color:#aaa; text-align:center; padding:20px;">ркХрлЛркИ ркпрк╛ркжрлЛ ркиркерлА</div>';
                    return;
                }
                
                view.innerHTML = recentMemories.map(mem => `
                    <div class="memory-item">
                        <div class="memory-text">${mem.text}</div>
                        <div class="memory-meta">
                            ${mem.category} тАв 
                            ${'тШЕ'.repeat(mem.importance)} тАв 
                            ${new Date(mem.date).toLocaleDateString('gu-IN')}
                        </div>
                    </div>
                `).join('');
            }
            
            // Backup memory
            backup() {
                const backupData = {
                    documents: this.documents,
                    memories: this.memories,
                    settings: this.settings,
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `vidushi_memory_backup_${new Date().toISOString().split('T')[0]}.json`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                return true;
            }
            
            // Get context for AI
            getContext(query) {
                if(!this.settings.enabled) return '';
                
                let context = '';
                
                // Add relevant documents
                const relevantDocs = this.search(query).documents.slice(0, 2);
                if(relevantDocs.length > 0) {
                    context += '\n[ркжрк╕рлНркдрк╛рк╡рлЗркЬ ркорк╛рк╣рк┐ркдрлА]:\n';
                    relevantDocs.forEach(doc => {
                        context += `тАв ${doc.name}: ${doc.content.substring(0, 200)}...\n`;
                    });
                }
                
                // Add relevant memories
                const relevantMemories = this.recallMemories(query, 3);
                if(relevantMemories.length > 0) {
                    context += '\n[рккрлВрк░рлНрк╡ ркЪрк░рлНркЪрк╛ркУ]:\n';
                    relevantMemories.forEach(mem => {
                        context += `тАв ${mem.text}\n`;
                        // Update recall count
                        mem.recallCount = (mem.recallCount || 0) + 1;
                        mem.lastRecalled = new Date().toISOString();
                    });
                }
                
                // Add recent conversations
                if(this.conversationHistory.length > 0) {
                    const recentConvs = this.conversationHistory.slice(-3);
                    context += '\n[ркдрк╛ркЬрлЗркдрк░ркирлА рк╡рк╛ркдркЪрлАркд]:\n';
                    recentConvs.forEach(conv => {
                        context += `тАв ркдркорлЗ: ${conv.user.substring(0, 50)}...\n`;
                        context += `тАв рк╣рлБркВ: ${conv.ai.substring(0, 50)}...\n`;
                    });
                }
                
                return context;
            }
        }
        
        // Initialize RAG Memory
        const ragMemory = new RAGMemory();
        
        // ==================== GLOBAL VARIABLES ====================
        let currentVideo = 'silent';
        let userName = localStorage.getItem('vidushi_username') || 'рк╕рк╛рк╣рлЗркм';
        let isListening = false;
        let lensMode = 'object';
        let cameraStream = null;
        let ragEnabled = true;
        
        // Videos
        const videos = {
            silent: document.getElementById('silent-video'),
            talking: document.getElementById('talking-video'),
            thinking: document.getElementById('thinking-video')
        };
        
        // ==================== CORE FUNCTIONS ====================
        function playVideo(type) {
            if(currentVideo === type) return;
            currentVideo = type;
            
            Object.values(videos).forEach(v => {
                v.style.display = 'none';
                v.pause();
            });
            
            if(videos[type]) {
                videos[type].style.display = 'block';
                videos[type].play().catch(e => console.log('Video play error:', e));
            }
        }
        
        function speak(text) {
            if(!text) return;
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'gu-IN';
            utterance.rate = 1.0;
            
            utterance.onstart = () => {
                document.getElementById('status').textContent = 'ркмрлЛрк▓рлБркВ ркЫрлБркВ...';
                playVideo('talking');
            };
            
            utterance.onend = () => {
                document.getElementById('status').textContent = 'ркдрлИркпрк╛рк░ ркЫрлБркВ';
                playVideo('silent');
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        // ==================== MODAL FUNCTIONS ====================
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            if(modalId === 'notes') loadNotes();
            if(modalId === 'documents') ragMemory.renderDocumentList();
            if(modalId === 'memory') ragMemory.renderMemoryView();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function saveSettings() {
            const name = document.getElementById('username').value;
            if(name) {
                userName = name;
                localStorage.setItem('vidushi_username', name);
            }
            
            // Save RAG settings
            const ragSettings = {
                enabled: document.getElementById('rag-enabled').checked,
                persistent: document.getElementById('persistent-memory').checked,
                autoRecall: document.getElementById('auto-recall').checked
            };
            
            ragMemory.updateSettings(ragSettings);
            ragEnabled = ragSettings.enabled;
            
            speak(`рк╕рлЗркЯрк┐ркВркЧрлНрк╕ рк╕рлЗрк╡ ркеркпрк╛. RAG ${ragEnabled ? 'ркЪрк╛рк▓рлБ' : 'ркмркВркз'}.`);
            closeModal('settings');
        }
        
        // ==================== RAG DOCUMENT FUNCTIONS ====================
        document.getElementById('doc-input').onchange = function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const content = event.target.result.substring(0, 10000); // Limit content
                ragMemory.addDocument(file.name, content);
                speak(`${file.name} ркЕрккрк▓рлЛркб ркеркпрлЛ. RAG ркорлЗркорк░рлАркорк╛ркВ рк╕рлЗрк╡ ркеркпрлЛ.`);
            };
            
            if(file.type.includes('text') || file.name.includes('.txt')) {
                reader.readAsText(file);
            } else {
                // For binary files, just store file info
                ragMemory.addDocument(file.name, `рклрк╛ркИрк▓: ${file.name}, рккрлНрк░ркХрк╛рк░: ${file.type}, ркорк╛ркк: ${file.size} bytes`);
                speak(`${file.name} ркЕрккрк▓рлЛркб ркеркпрлЛ.`);
            }
        };
        
        function clearRAGDocuments() {
            if(confirm('ркмркзрк╛ ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркбрк┐рк▓рлАркЯ ркХрк░рк╡рк╛ ркЫрлЗ?')) {
                ragMemory.clearDocuments();
                speak('ркмркзрк╛ ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ рк╕рк╛ркл ркХрк░рлНркпрк╛.');
            }
        }
        
        function backupMemory() {
            if(ragMemory.backup()) {
                speak('ркорлЗркорк░рлА ркмрлЗркХркЕркк рк╕рлЗрк╡ ркеркпрлЛ.');
            }
        }
        
        function clearMemory() {
            if(confirm('ркмркзрлА ркорлЗркорк░рлА ркбрк┐рк▓рлАркЯ ркХрк░рк╡рк╛ ркЫрлЗ?')) {
                ragMemory.clearMemories();
                speak('ркмркзрлА ркорлЗркорк░рлА рк╕рк╛ркл ркХрк░рлА.');
            }
        }
        
        // ==================== NOTES FUNCTIONS ====================
        function loadNotes() {
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            
            notes.forEach((note, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'background:#333; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center;';
                div.innerHTML = `
                    <div>${note}</div>
                    <button onclick="deleteNote(${index})" style="background:red; color:white; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer;">├Ч</button>
                `;
                list.appendChild(div);
            });
        }
        
        function addNote() {
            const input = document.getElementById('note-input');
            const text = input.value.trim();
            if(!text) return;
            
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            notes.push(text);
            localStorage.setItem('vidushi_notes', JSON.stringify(notes));
            
            // Also add to RAG memory
            if(ragEnabled) {
                ragMemory.addMemory(`ркирлЛркВркз: ${text}`, 'note', 2);
            }
            
            input.value = '';
            loadNotes();
            speak('ркирлЛркВркз ркЙркорлЗрк░рлА.');
        }
        
        function deleteNote(index) {
            const notes = JSON.parse(localStorage.getItem('vidushi_notes') || '[]');
            notes.splice(index, 1);
            localStorage.setItem('vidushi_notes', JSON.stringify(notes));
            loadNotes();
        }
        
        // ==================== SMART LENS FUNCTIONS ====================
        function setLensMode(mode, element) {
            document.querySelectorAll('.lens-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            lensMode = mode;
        }
        
        function openCamera() {
            closeModal('lens');
            document.getElementById('status').textContent = 'ркХрлЗркорлЗрк░рк╛ ркЦрлЛрк▓рлБркВ ркЫрлБркВ...';
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('camera-video');
                    video.srcObject = stream;
                    video.style.display = 'block';
                    playVideo('silent');
                    
                    // Capture after 3 seconds
                    setTimeout(captureImage, 3000);
                })
                .catch(error => {
                    console.error('Camera error:', error);
                    speak('ркХрлЗркорлЗрк░рк╛ркирлА рккрк░ркорк┐рк╢рки ркиркерлА.');
                });
        }
        
        function captureImage() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Stop camera
            if(cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            video.style.display = 'none';
            
            // Convert to data URL and show
            const dataUrl = canvas.toDataURL('image/jpeg');
            showImage(dataUrl);
            analyzeImage(dataUrl);
        }
        
        function openGallery() {
            closeModal('lens');
            document.getElementById('file-input').click();
        }
        
        document.getElementById('file-input').onchange = function(e) {
            const file = e.target.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                showImage(event.target.result);
                analyzeImage(event.target.result);
            };
            reader.readAsDataURL(file);
        };
        
        function showImage(dataUrl) {
            document.getElementById('viewed-image').src = dataUrl;
            document.getElementById('image-view').style.display = 'flex';
        }
        
        function closeImageView() {
            document.getElementById('image-view').style.display = 'none';
            document.getElementById('image-analysis').style.display = 'none';
        }
        
        async function analyzeImage(dataUrl) {
            document.getElementById('status').textContent = 'рк╡рк┐рк╢рлНрк▓рлЗрк╖ркг ркХрк░рлБркВ ркЫрлБркВ...';
            playVideo('thinking');
            
            // Convert data URL to blob
            const blob = await fetch(dataUrl).then(res => res.blob());
            
            // Get RAG context if enabled
            let ragContext = '';
            if(ragEnabled && lensMode === 'document') {
                ragContext = '\n[ркжрк╕рлНркдрк╛рк╡рлЗркЬ ркорлЛркб]: RAG ркорлЗркорк░рлАркорк╛ркВркерлА рк╕ркВркмркВркзрк┐ркд ркорк╛рк╣рк┐ркдрлА ркЬрлЛркбрлА ркЫрлЗ.';
            }
            
            // Simulate AI analysis with RAG context
            setTimeout(() => {
                const analysis = getMockAnalysis(lensMode) + ragContext;
                document.getElementById('image-analysis').innerHTML = analysis;
                document.getElementById('image-analysis').style.display = 'block';
                
                // Add to RAG memory if important
                if(ragEnabled && lensMode !== 'object') {
                    ragMemory.addMemory(`ркЪрк┐ркдрлНрк░ рк╡рк┐рк╢рлНрк▓рлЗрк╖ркг (${lensMode}): ${analysis.substring(0, 100)}`, 'vision', 2);
                }
                
                speak(analysis);
                document.getElementById('status').textContent = 'ркдрлИркпрк╛рк░ ркЫрлБркВ';
                playVideo('silent');
            }, 2000);
        }
        
        function getMockAnalysis(mode) {
            const analyses = {
                object: 'ЁЯУ╕ ркЖ ркЪрк┐ркдрлНрк░ркорк╛ркВ ркПркХ рк╡рлНркпркХрлНркдрк┐ ркЬрлЛрк╡рк╛ ркорк│рлЗ ркЫрлЗ. рккрлБрк░рлБрк╖, ркоркзрлНркпрко рк╡ркп, рк╕рлНркорк┐ркд ркХрк░ркдрк╛.',
                text: 'ЁЯУЬ ркЖ ркЪрк┐ркдрлНрк░ркорк╛ркВ ркЧрлБркЬрк░рк╛ркдрлА рк▓рк┐рккрк┐: "ркЬркп рк╢рлНрк░рлА ркХрлГрк╖рлНркг".',
                math: 'ЁЯФв ркЖ ркЪрк┐ркдрлНрк░ркорк╛ркВ ркЧркгрк┐ркд: рли + рли = рлк.',
                translate: 'ЁЯМР "Hello World" тЖТ "рк╣рлЗрк▓рлЛ рк╡рк░рлНрк▓рлНркб".',
                document: 'ЁЯУД ркЖ ркжрк╕рлНркдрк╛рк╡рлЗркЬркорк╛ркВ ркорлБркЦрлНркп ркорлБркжрлНркжрк╛ркУ ркЫрлЗ. RAG ркорлЗркорк░рлА рк╕рк╛ркерлЗ рк╕рк░ркЦрк╛рк╡рлБркВ ркЫрлБркВ.',
                memory: 'ЁЯза ркЖ ркЪрк┐ркдрлНрк░ рккрк╣рлЗрк▓рк╛ркирлА ркпрк╛ркжрлЛ рк╕рк╛ркерлЗ ркорлЗрк│ ркЦрк╛ркп ркЫрлЗ.'
            };
            return analyses[mode] || 'рк╡рк┐рк╢рлНрк▓рлЗрк╖ркг ркорк│рлНркпрлБркВ ркиркерлА.';
        }
        
        // ==================== VOICE RECOGNITION ====================
        let recognition = null;
        if('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'gu-IN';
            
            recognition.onstart = () => {
                isListening = true;
                document.getElementById('status').textContent = 'рк╕рк╛ркВркнрк│рлБркВ ркЫрлБркВ...';
                document.getElementById('mic-btn').style.background = 'red';
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('status').textContent = 'рк╡рк┐ркЪрк╛рк░рлБркВ ркЫрлБркВ...';
                processVoiceCommand(transcript);
            };
            
            recognition.onend = () => {
                isListening = false;
                document.getElementById('mic-btn').style.background = '#ff4500';
            };
        }
        
        function toggleMic() {
            if(!recognition) {
                speak('рк╡рлЙркЗрк╕ рк░рлЗркХрлЛркЧрлНркирк┐рк╢рки рк╕рккрлЛрк░рлНркЯ ркиркерлА.');
                return;
            }
            
            if(isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }
        
        function processVoiceCommand(command) {
            console.log('Command:', command);
            const cmd = command.toLowerCase();
            
            playVideo('thinking');
            
            // Get RAG context for AI response
            let ragContext = '';
            if(ragEnabled) {
                ragContext = ragMemory.getContext(command);
                
                // Add conversation to memory
                ragMemory.addMemory(`рк╡рккрк░рк╛рк╢ркХрк░рлНркдрк╛: ${command}`, 'user_query', 1);
            }
            
            // Process command with RAG
            if(cmd.includes('ркиркорк╕рлНркдрлЗ') || cmd.includes('рк╣рлЗрк▓рлЛ')) {
                const response = `ркиркорк╕рлНркдрлЗ ${userName}! RAG ркорлЗркорк░рлА ${ragEnabled ? 'рк╕ркХрлНрк░рк┐ркп' : 'ркирк┐рк╖рлНркХрлНрк░рк┐ркп'}.`;
                speak(response);
                if(ragEnabled) {
                    ragMemory.addConversation(command, response);
                    ragMemory.addMemory(response, 'greeting', 3);
                }
            }
            else if(cmd.includes('ркдрлБркВ ркХрлЛркг ркЫрлЛ')) {
                const response = 'рк╣рлБркВ рк╡рк┐ркжрлБрк╖рлА ркЫрлБркВ, RAG ркорлЗркорк░рлА рк╕рк╛ркерлЗркирлА AI рк╕рк╣рк╛ркпркХ.';
                speak(response);
                if(ragEnabled) ragMemory.addConversation(command, response);
            }
            else if(cmd.includes('рк╕рлНркорк╛рк░рлНркЯ рк▓рлЗркирлНрк╕') || cmd.includes('ркХрлЗркорлЗрк░рк╛')) {
                openModal('lens');
                speak('рк╕рлНркорк╛рк░рлНркЯ рк▓рлЗркирлНрк╕ ркЦрлЛрк▓рлБркВ ркЫрлБркВ.');
                if(ragEnabled) ragMemory.addMemory('рк╕рлНркорк╛рк░рлНркЯ рк▓рлЗркирлНрк╕ ркЦрлЛрк▓рлНркпрлБркВ', 'action', 2);
            }
            else if(cmd.includes('рклрлЛркЯрлЛ рк▓рлЛ')) {
                openCamera();
                if(ragEnabled) ragMemory.addMemory('ркХрлЗркорлЗрк░рк╛ ркЦрлЛрк▓рлНркпрлБркВ', 'action', 2);
            }
            else if(cmd.includes('ркжрк╕рлНркдрк╛рк╡рлЗркЬ') || cmd.includes('ркбрлЛркХрлНркпрлБркорлЗркирлНркЯ')) {
                openModal('documents');
                speak('RAG ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркЦрлЛрк▓рлБркВ ркЫрлБркВ.');
            }
            else if(cmd.includes('ркорлЗркорк░рлА') || cmd.includes('ркпрк╛ркж')) {
                openModal('memory');
                speak(`RAG ркорлЗркорк░рлА: ${ragMemory.memories.length} ркпрк╛ркжрлЛ.`);
            }
            else if(cmd.includes('ркпрк╛ркж рк░рк╛ркЦ') || cmd.includes('рк░рлАркорлЗркорлНркмрк░')) {
                const text = cmd.replace(/ркпрк╛ркж рк░рк╛ркЦ|рк░рлАркорлЗркорлНркмрк░|ркХрлЗ/g, '').trim();
                if(text) {
                    ragMemory.addMemory(text, 'user_command', 5);
                    speak(`ркпрк╛ркж рк░рк╛ркЦрлА рк▓рлАркзрлБркВ: ${text.substring(0, 50)}`);
                }
            }
            else if(cmd.includes('ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИркирлЛ рклрлЛркЯрлЛ')) {
                speak('ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИркирлЛ рклрлЛркЯрлЛ ркмркдрк╛рк╡рлБркВ ркЫрлБркВ.');
                // Show a sample photo
                showImage('https://via.placeholder.com/300x400/FFA500/000000?text=ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ');
                setTimeout(() => {
                    document.getElementById('image-analysis').innerHTML = 'ЁЯСд ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ - рккрк░рк┐рк╡рк╛рк░ркирк╛ ркорлБркЦрлНркп';
                    document.getElementById('image-analysis').style.display = 'block';
                }, 500);
                
                if(ragEnabled) {
                    ragMemory.addMemory('ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИркирлЛ рклрлЛркЯрлЛ ркмркдрк╛рк╡рлНркпрлЛ', 'action', 3);
                }
            }
            else {
                // Use RAG context for better response
                let response = `ркдркорлЗ ркХрк╣рлНркпрлБркВ: ${command}. `;
                if(ragContext) {
                    response += ' RAG ркорлЗркорк░рлАркорк╛ркВркерлА рк╕ркВркмркВркзрк┐ркд ркорк╛рк╣рк┐ркдрлА ркорк│рлА ркЫрлЗ.';
                }
                speak(response);
                
                if(ragEnabled) {
                    ragMemory.addConversation(command, response);
                    
                    // Auto-learn from conversation
                    if(command.length > 10 && !command.includes('?')) {
                        ragMemory.addMemory(`рк╡рккрк░рк╛рк╢ркХрк░рлНркдрк╛ркирлБркВ рк╡рк┐ркзрк╛рки: ${command}`, 'learning', 1);
                    }
                }
            }
            
            setTimeout(() => {
                document.getElementById('status').textContent = 'ркдрлИркпрк╛рк░ ркЫрлБркВ';
                playVideo('silent');
            }, 2000);
        }
        
        // ==================== INITIALIZATION ====================
        window.onload = () => {
            playVideo('silent');
            
            // Load settings
            document.getElementById('username').value = userName;
            document.getElementById('rag-enabled').checked = ragMemory.settings.enabled;
            document.getElementById('persistent-memory').checked = ragMemory.settings.persistent;
            document.getElementById('auto-recall').checked = ragMemory.settings.autoRecall;
            ragEnabled = ragMemory.settings.enabled;
            
            // Welcome message with RAG status
            setTimeout(() => {
                if(!localStorage.getItem('vidushi_welcomed')) {
                    speak(`ркиркорк╕рлНркдрлЗ ${userName}! рк╣рлБркВ рк╡рк┐ркжрлБрк╖рлА, RAG ркорлЗркорк░рлА рк╕рк╛ркерлЗ. ${ragMemory.documents.length} ркжрк╕рлНркдрк╛рк╡рлЗркЬрлЛ ркЕркирлЗ ${ragMemory.memories.length} ркпрк╛ркжрлЛ рк▓рлЛркб ркеркпрк╛.`);
                    localStorage.setItem('vidushi_welcomed', 'true');
                }
            }, 1500);
        };
    </script>
</body>
</html>
